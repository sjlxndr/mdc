<!DOCTYPE html>
<html lang="en">
<head>
<!--
Markdown Converter - A browser-based Markdown editor with HTML conversion and live preview
Copyright (c) 2025 Stephen Alexander
MIT License

This application uses:
- Showdown (v2.1.0) - MIT License - https://github.com/showdownjs/showdown 
- DOMPurify (v3.2.5) - Dual-licensed under Apache License 2.0 and Mozilla Public License 2.0 - https://github.com/cure53/DOMPurify
-->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A browser-based Markdown editor with HTML conversion and live preview">
  <meta name="theme-color" content="#243043">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="application-name" content="Markdown Converter">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" type="image/svg+xml" href="./icons/icon-192x192.svg">
  <link rel="apple-touch-icon" href="./icons/icon-192x192.svg">
  <title>Markdown Converter</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.2.5/purify.min.js" defer></script>
  <script>
'use strict';
function footnotes(options) {
  var footnoteMap = {};
  
  options = options || {};
  var indentSpaces = options.indentSpaces || 2;
  
  var indentRegex = new RegExp('^\\s{' + indentSpaces + ',}|\\t');
  
  var trimRegex = new RegExp('^(\\s{' + indentSpaces + '})');

  return [
 {
      type: 'lang',
      filter: function(text) {
        footnoteMap = {};
        var codeBlocks = [];
        var processedText = text.replace(/```[\s\S]*?```|`[^`]*`/g, function(match) {
          codeBlocks.push(match);
          return "CODE_BLOCK_" + (codeBlocks.length - 1);
      });
        
        var footnoteDefinitions = {};
        var footnotePattern = /^\[\^([\d\w]+)\]:\s*(.*?)$/gm;
        var textLines = processedText.split('\n');
        var match;
        var lineIndexesToRemove = [];

        while ((match = footnotePattern.exec(processedText)) !== null) {
          if (/CODE_BLOCK_\d+/.test(match[0])) continue;
          
          var footnoteId = match[1];
          var firstLine = match[2];
          var startLineIndex = processedText.substring(0, match.index).split('\n').length - 1;

          footnoteDefinitions[footnoteId] = {
            content: firstLine,
            startLine: startLineIndex,
            continuationLines: []
        };

          lineIndexesToRemove.push(startLineIndex);
      }

        Object.keys(footnoteDefinitions).forEach(function(id) {
          var def = footnoteDefinitions[id];
          var lineIndex = def.startLine + 1;

          while (lineIndex < textLines.length) {
            var line = textLines[lineIndex];
            if (indentRegex.test(line)) {
              var trimmedLine = line.replace(trimRegex, '');
              def.continuationLines.push(trimmedLine);
              lineIndexesToRemove.push(lineIndex);
              lineIndex++;
          } else if (line.trim() === '') {
              if (lineIndex + 1 < textLines.length && indentRegex.test(textLines[lineIndex + 1])) {
                def.continuationLines.push('\n\n'); // Add paragraph breaks instead of line breaks
                lineIndexesToRemove.push(lineIndex);
                lineIndex++;
            } else {
                break;
            }
          } else {
              break;
          }
        }

          var fullContent = def.content;

          if (def.continuationLines.length > 0) {
            var paragraphs = [];
            var currentParagraph = [];

            def.continuationLines.forEach(function(line) {
              if (line === '\n\n') {
                if (currentParagraph.length > 0) {
                  paragraphs.push(currentParagraph.join(' '));
                  currentParagraph = [];
              }
            } else {
                currentParagraph.push(line);
            }
          });

            if (currentParagraph.length > 0) {
              paragraphs.push(currentParagraph.join(' '));
          }

            if (paragraphs.length > 0) {
              fullContent = '<p>' + fullContent + '</p><p>' + paragraphs.join('</p><p>') + '</p>';
          } else {
              fullContent = '<p>' + fullContent + '</p>';
          }
        } else {
            fullContent = '<p>' + fullContent + '</p>';
        }

          footnoteMap[id] = fullContent;
      });

        var newTextLines = textLines.filter(function(_, index) {
          return !lineIndexesToRemove.includes(index);
      });

        var result = newTextLines.join('\n');
        
        result = result.replace(/CODE_BLOCK_(\d+)/g, function(match, index) {
          return codeBlocks[parseInt(index)];
      });
        
        return result;
    }
  },
 {
      type: 'lang',
      filter: function(text) {
        var codeBlocks = [];
        var processedText = text.replace(/```[\s\S]*?```|`[^`]*`/g, function(match) {
          codeBlocks.push(match);
          return "CODE_BLOCK_" + (codeBlocks.length - 1);
      });
        
        processedText = processedText.replace(/\[\^([\d\w]+)\]/g, function(str, name) {
          if (/CODE_BLOCK_\d+/.test(str)) return str;
          return '<a id="footnote-ref-' + name + '" href="#footnote-' + name + '" class="footnote-ref">[' + name + ']</a>';
      });
        
        return processedText.replace(/CODE_BLOCK_(\d+)/g, function(match, index) {
          return codeBlocks[parseInt(index)];
      });
    }
  },
 {
      type: 'output',
      filter: function(html) {
        if (Object.keys(footnoteMap).length === 0) {
          return html; // No footnotes to add
      }

        var footnotesHtml = '<div class="footnotes-section">';
        footnotesHtml += '<hr>';
        footnotesHtml += '<h2>Footnotes</h2>';
        footnotesHtml += '<div class="footnotes">';

        var footnoteNames = Object.keys(footnoteMap);
        footnoteNames.sort(function(a, b) {
          if (!isNaN(a) && !isNaN(b)) {
            return parseInt(a) - parseInt(b);
        }
          return a.localeCompare(b);
      });

        for (var i = 0; i < footnoteNames.length; i++) {
          var name = footnoteNames[i];
          var content = footnoteMap[name];
          footnotesHtml += '<div class="footnote" id="footnote-' + name + '">' +
                            '<a href="#footnote-ref-' + name + '" class="footnote-backref">[' + name + ']</a> ' +
                            '<span class="footnote-content">' + content + '</span>' +
                          '</div>';
      }

        footnotesHtml += '</div></div>';
        return html + footnotesHtml;
    }
}
  ];
}
  </script>
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
}
    
    :root {
      --primary-color: #3498db;
      --primary-hover: #0366d6;
      --background-color: #f8f9fa;
      --border-color: #dee2e6;
      --border-light: #dfe2e5;
      --border-dark: #444;
      --text-color: #343a40;
      --text-muted: #6a737d;
      --text-light: #B0B8C1;
      --code-bg: #f6f8fa;
      --code-bg-dark: #2d2d2d;
      --shadow-light: rgba(0,0,0,0.02);
      --shadow-dark: rgba(255,255,255,0.05);
      --code-inline-bg: rgba(27,31,35,0.05);
      --warning-bg: rgba(255, 129, 40, 0.25);
      --success-bg: #4CAF50;
      --radius-sm: 3px;
      --radius: 4px;
      --spacing-xs: 5px;
      --spacing-sm: 8px;
      --spacing: 10px;
      --spacing-md: 16px;
      --spacing-lg: 20px;
      --spacing-xl: 40px;
}
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
      color: var(--text-color);
      margin: 0;
      padding: 0;
      background-color: var(--background-color);
}
    
    .container {
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
      padding: 20px;
      box-sizing: border-box;
}
    
    .editor-container {
      display: flex;
      height: calc(100vh - 100px);
      min-height: 400px;
      position: relative;
      justify-content: center;
      width: 100%;
}
    
    .editor-pane, .preview-pane {
      flex: 1 1 0;
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      background-color: white;
      overflow: auto;
      position: relative;
      min-width: 100px;
}
    

    .splitter {
      width: 12px;
      background-color: var(--border-color);
      cursor: col-resize;
      position: relative;
      z-index: 5;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background-color 0.2s;
      margin: 0 2px;
}
    
    .splitter:hover, .splitter:focus {
      background-color: var(--primary-color);
      outline: none;
}
    
    .splitter-handle {
      width: 4px;
      height: 50px;
      background-color: var(--primary-color);
      border-radius: 2px;
      opacity: 0.5;
      transition: opacity 0.2s, height 0.2s;
}
    
    .splitter:hover .splitter-handle, .splitter:focus .splitter-handle {
      opacity: 1;
      height: 100px;
}
    
    .splitter.dragging {
      background-color: var(--primary-color);
      opacity: 0.7;
}
    
    .splitter.dragging .splitter-handle {
      opacity: 1;
      height: 120px;
}
    
    .editor-pane {
      display: flex;
      flex-direction: column;
}
    
    #markdown-editor {
      flex: 1;
      padding: 15px;
      resize: none;
      border: none;
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 14px;
      line-height: 1.6;
      outline: none;
}
    
    .preview-pane {
      padding: 15px;
}
    
    .toolbar {
      background-color: #f1f3f5;
      padding: 10px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      gap: 10px;
}
    
    .button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius);
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
}
    
    .button:hover {
      background-color: #2980b9;
}
    

    input[type="text"] {
      padding: var(--spacing-sm);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      background-color: white;
      color: #333;
}
    

    .checkbox-container {
      display: flex;
      align-items: center;
      margin-left: 10px;
}
    
    .checkbox-container input[type="checkbox"] {
      margin-right: 5px;
}
    

    .dark-mode .button {
      background-color: #2c5282; /* Darker blue */
      color: #f0f4f8; /* Off-white for better contrast */
}
    
    .dark-mode .button:hover {
      background-color: #3a6ea5; /* Slightly lighter when hovered */
}
    

    .dark-mode input[type="text"] {
      background-color: #3d3d3d;
      color: #f0f4f8;
      border-color: #555;
}
    

    .dark-mode *::-webkit-scrollbar {
      width: 12px;
      height: 12px;
}
    
    .dark-mode *::-webkit-scrollbar-track {
      background: #2d2d2d;
}
    
    .dark-mode *::-webkit-scrollbar-thumb {
      background-color: #555;
      border-radius: 6px;
      border: 3px solid #2d2d2d;
}
    
    .dark-mode *::-webkit-scrollbar-thumb:hover {
      background-color: #666;
}
    
    .action-bar {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      justify-content: flex-start;
      align-items: center;
      flex-wrap: wrap;
}
    

    .preview-content {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
}
    
    .preview-content pre {
      background-color: var(--code-bg);
      padding: var(--spacing-sm) var(--spacing);
      overflow: auto;
      border-radius: var(--radius-sm);
      font-size: 0.95em;
      line-height: 1.3;
}
    
    .preview-content code {
      border-radius: var(--radius-sm);
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 0.95em;
}
    

    .preview-content :not(pre) > code {
      background-color: var(--code-inline-bg);
}
    
    .preview-content table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 16px;
}
    
    .preview-content table, .preview-content th, .preview-content td {
      border: 1px solid var(--border-light);
      padding: var(--spacing-sm);
}
    
    .preview-content img {
      max-width: 100%;
}
    
    .preview-content blockquote {
      border-left: 4px solid var(--border-light);
      padding-left: var(--spacing-md);
      color: var(--text-muted);
      margin-left: 0;
}
    

    .footnote {
      margin-top: var(--spacing-sm);
      margin-bottom: var(--spacing-sm);
      padding: var(--spacing-xs) var(--spacing);
      font-size: 0.9em;
      color: var(--text-muted);
      background-color: var(--shadow-light);
      border-radius: var(--radius);
}

    .footnote .footnote-content {
      display: inline-block;
      vertical-align: top;
}

    .footnote .footnote-content p {
      margin: 0;
}

    .footnote .footnote-content p + p {
      margin-top: 0.8em;
}

    .dark-mode .footnote {
      color: var(--text-light);
      background-color: var(--shadow-dark);
}

    .footnote a {
      text-decoration: none;
}


    .footnote-ref {
      text-decoration: none;
      display: inline;
      font-size: 0.75em;
      vertical-align: super;
      line-height: normal;
      color: var(--primary-hover);
      padding: 0 1px;
}


    .footnote-backref {
      text-decoration: none;
      font-size: 0.85em;
      color: var(--primary-hover);
      margin-right: var(--spacing-xs);
      font-weight: bold;
}


    .footnotes-section {
      margin-top: var(--spacing-xl);
}

    .footnotes-section hr {
      border: none;
      border-top: 1px solid var(--border-light);
      margin: 30px 0 var(--spacing-lg) 0;
}

    .dark-mode .footnotes-section hr {
      border-top: 1px solid var(--border-dark);
}

    .footnotes-section h2 {
      font-size: 1.2em;
      margin-bottom: var(--spacing-lg);
}

    .footnotes {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
}
    

    @media print {
      .editor-pane, .toolbar, .action-bar, .splitter, .mobile-tabs {
        display: none !important;
    }
      
      .editor-container {
        display: block;
        height: auto;
    }
      
  
      .preview-pane {
        display: block !important;
        width: 100% !important;
    }
      
  
      .container.mobile-view-editor .preview-pane,
      .container.mobile-view-preview .preview-pane {
        display: block !important;
    }
      
      .preview-pane {
        border: none;
        height: auto;
        overflow: visible;
        color: black !important;
        background-color: white !important;
    }
      
  
      body, .preview-content {
        background-color: white !important;
        color: black !important;
    }
      
  
      .preview-content a {
        color: #0366d6 !important;
        text-decoration: underline !important;
    }
      
  
      p, li, h1, h2, h3, h4, h5, h6, table, blockquote {
        page-break-inside: avoid;
        color: black !important;
    }
      
  
      h1, h2 {
        page-break-after: avoid;
        break-after: avoid;
    }
      
  
      h1, h2, h3, h4, h5, h6 {
        page-break-after: avoid;
        break-after: avoid;
    }
      
  
      pre {
        page-break-inside: avoid;
        break-inside: avoid;
        background-color: #f6f8fa !important;
        color: #24292e !important;
        font-size: 0.9em !important;
        line-height: 1.3 !important;
        padding: 12px !important;
    }
      
      code {
        background-color: rgba(27,31,35,0.05) !important;
        color: #24292e !important;
        font-size: 0.9em !important;
    }
      
  
      table {
        page-break-inside: avoid;
        break-inside: avoid;
        color: black !important;
    }
      
  
      .footnotes-section hr {
        border-top: 1px solid #000;
    }

      .footnotes-section h2 {
        font-size: 14pt;
        margin-bottom: 10pt;
    }

      .footnote {
        font-size: 10pt;
        break-inside: avoid;
        background-color: transparent !important;
        color: black !important;
    }
      
      .footnote-ref, .footnote-backref {
        color: black !important;
    }
      
  
      @page {
        margin: 2cm;
    }
}
    

    .dark-mode {
      --primary-color: #61dafb;
      --background-color: #1a1a1a;
      --border-color: #444;
      --text-color: #f1f3f5;
}
    
    .dark-mode .editor-pane,
    .dark-mode .preview-pane {
      background-color: #2d2d2d;
      color: var(--text-color);
}
    
    .dark-mode #markdown-editor {
      background-color: #2d2d2d;
      color: var(--text-color);
}
    
    .dark-mode .toolbar {
      background-color: #333;
}
    

    .dark-mode .preview-content pre {
      background-color: #222;
      border: 1px solid var(--border-color);
      font-size: 0.9em;
      line-height: 1.3;
}
    
    .dark-mode .preview-content code {
      color: #e6e6e6;
      font-size: 0.9em;
}
    

    .dark-mode .preview-content :not(pre) > code {
      background-color: #333;
}
    

    .dark-mode .preview-content a {
      color: #78c8ff; /* More legible blue for dark mode */
      text-decoration: underline;
      border-bottom: none;
      padding-bottom: 0;
      font-weight: normal;
}
    

    .preview-content a {
      color: #0366d6; /* GitHub-style blue for light mode */
      text-decoration: underline;
      border-bottom: none;
      padding-bottom: 0;
      font-weight: normal;
}
    

    .dark-mode .checkbox-container {
      color: var(--text-color);
}
    


    .flavor-selector {
      display: flex;
      align-items: center;
      margin: 0 10px;
      padding: 0 5px;
}
    

    @media (max-width: 768px) {
      .flavor-selector {
        margin: 0 5px;
    }
      
      .flavor-selector label {
        font-size: 12px;
    }
}
    
    .flavor-selector label {
      margin-right: 5px;
      font-size: 14px;
}
    
    .flavor-selector select {
      padding: 3px 6px;
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      background-color: white;
      font-size: 14px;
}
    
    .dark-mode .flavor-selector select {
      background-color: #3d3d3d;
      color: var(--text-color);
      border-color: #555;
}
    
    .dark-mode .flavor-selector label {
      color: var(--text-color);
}
    
    .theme-switch-wrapper {
      display: flex;
      align-items: center;
      margin-left: auto;
}
    
    .theme-switch {
      position: relative;
      display: inline-block;
      height: 26px;
      width: 60px;
      vertical-align: middle;
}
    
    .theme-switch input {
      opacity: 0;
      width: 0;
      height: 0;
      position: absolute;
}
    
    .theme-switch-label {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: block;
      height: 26px;
      width: 60px;
      background-color: #2d2d2d;
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.3s ease;
}
    
    .theme-switch-toggle {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      border-radius: 62px;
      background: white;
      transition: all 0.3s ease;
}
    
    input:checked + .theme-switch-label .theme-switch-toggle {
      transform: translateX(34px);
}
    
    input:checked + .theme-switch-label {
      background-color: #333;
}
    
    .theme-icon {
      position: absolute;
      top: 3px;
      font-size: 16px;
      transition: all 0.3s ease;
      line-height: 20px;
}
    
    .theme-icon.light {
      right: 8px;
      opacity: 0;
}
    
    .theme-icon.dark {
      left: 8px;
      opacity: 1;
}
    
    input:checked + .theme-switch-label .theme-icon.light {
      opacity: 0;
}
    
    input:checked + .theme-switch-label .theme-icon.dark {
      opacity: 1;
}
    
    input:not(:checked) + .theme-switch-label .theme-icon.light {
      opacity: 1;
}
    
    input:not(:checked) + .theme-switch-label .theme-icon.dark {
      opacity: 0;
}
    

    body:not(.dark-mode) .theme-switch-label {
      background-color: #e6e6e6;
}
    

    kbd {
      background-color: #f7f7f7;
      border: 1px solid #ccc;
      border-radius: 3px;
      box-shadow: 0 1px 0 rgba(0,0,0,0.2);
      color: #333;
      display: inline-block;
      font-family: monospace;
      font-size: 0.9em;
      font-weight: bold;
      line-height: 1;
      padding: 3px 6px;
      margin: 0 2px;
      vertical-align: middle;
}
    
    .dark-mode kbd {
      background-color: #444;
      border-color: #666;
      color: #f7f7f7;
      box-shadow: 0 1px 0 rgba(255,255,255,0.2);
}
    

    a {
      color: #0366d6; /* GitHub-style blue for light mode */
      text-decoration: none;
      border-bottom: 1px solid rgba(3, 102, 214, 0.3);
      padding-bottom: 1px;
      font-weight: 500;
      transition: color 0.2s, border-bottom 0.2s;
}
    
    a:hover {
      color: #0550ae;
      border-bottom: 1px solid rgba(3, 102, 214, 0.7);
}
    
    a:active {
      color: #032f70;
      border-bottom: 1px solid #0366d6;
}
    

    .dark-mode a {
      color: #78c8ff; /* More legible blue for dark mode */
      border-bottom: 1px solid rgba(120, 200, 255, 0.3);
}
    
    .dark-mode a:hover {
      color: #94d3ff;
      border-bottom: 1px solid rgba(120, 200, 255, 0.7);
}
    
    .dark-mode a:active {
      color: #60b3ff;
      border-bottom: 1px solid #78c8ff;
}
    

    .modal {
      display: none; /* Hidden by default, will be overridden when shown */
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.3s;
      align-items: center;
      justify-content: center;
      overflow: auto;
}
    
    .modal[style*="display: block"] {
      display: flex !important; /* Override to flex when modal is shown */
}
    
    .modal-content {
      position: relative;
      margin: 20px auto;
      width: 80%;
      max-width: 600px;
      max-height: 90vh;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      animation: slideIn 0.3s;
      display: flex;
      flex-direction: column;
      outline: none; /* Remove default outline */
}
    

    .modal a:focus,
    .modal button:focus,
    .modal input:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
      box-shadow: 0 0 0 4px rgba(255, 129, 40, 0.25);
}
    
    .dark-mode .modal-content {
      background-color: #2d2d2d;
      color: var(--text-color);
}
    
    .modal-header {
      padding: 15px 20px;
      border-bottom: 1px solid var(--border-color);
}
    
    .modal-header h2 {
      margin: 0;
      font-size: 1.5rem;
}
    
    .modal-body {
      padding: 20px;
      max-height: calc(90vh - 120px); /* Account for header and footer */
      overflow-y: auto;
      flex: 1;
}
    
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid var(--border-color);
      text-align: center;
}
    
    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
}
    
    @keyframes slideIn {
      from {transform: translateY(-20px); opacity: 0;}
      to {transform: translateY(0); opacity: 1;}
}
    

    .mobile-tabs {
      display: none;
      width: 100%;
      padding: 0;
      margin: 0 0 10px 0;
      background-color: var(--background-color);
      border-bottom: 1px solid var(--border-color);
}
    
    .tab-button {
      flex: 1;
      padding: 12px;
      background-color: var(--background-color);
      border: none;
      border-bottom: 3px solid transparent;
      font-weight: bold;
      font-size: 16px;
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.3s ease;
}
    
    .tab-button.active {
      border-bottom: 3px solid var(--primary-color);
      color: var(--primary-color);
}
    
    .dark-mode .tab-button {
      background-color: var(--background-color);
      color: var(--text-color);
}
    
    .dark-mode .tab-button.active {
      color: var(--primary-color);
}
    

    @media (max-width: 768px) {
      .mobile-tabs {
        display: flex;
    }
      
      .editor-container {
        flex-direction: column;
        height: calc(100vh - 140px);
    }
      
      .editor-pane, .preview-pane {
        flex: 1 1 auto !important;
        width: 100% !important;
        height: 100% !important;
    }
      
  
      .mobile-view-editor .preview-pane {
        display: none !important;
    }
      
      .mobile-view-preview .editor-pane {
        display: none !important;
    }
      
  
      .splitter {
        display: none !important;
    }
      
      .action-bar {
        flex-direction: column;
        align-items: stretch;
    }
}
  </style>
</head>
<body class="dark-mode">
  <main class="container">
    <!-- Screen reader announcements -->
    <div aria-live="polite" class="sr-only" id="sr-announcements" style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;"></div>
    
    <!-- Mobile Tab Navigation (hidden on desktop) -->
    <nav class="mobile-tabs" >
      <button class="tab-button active" data-tab="editor">Editor</button>
      <button class="tab-button" data-tab="preview">Preview</button>
    </nav>
    
    <div class="editor-container">
      <div class="editor-pane">
        <header class="toolbar">
          <button class="button" id="clear-btn">Clear</button>
          <button class="button" id="sample-btn">Load Sample</button>
          <button class="button" id="info-btn" >❓</button>
          
          <!-- Markdown flavor selector -->
          <div class="flavor-selector">
            <label for="flavor">Flavor:</label>
            <select id="flavor" >
              <option value="github">GitHub</option>
              <option value="vanilla">CommonMark</option>
            </select>
          </div>
          
          <div class="theme-switch-wrapper">
            <div class="theme-switch">
              <input type="checkbox" id="theme-switch-checkbox" checked>
              <label for="theme-switch-checkbox" class="theme-switch-label">
                <span class="theme-icon light">🔆</span>
                <span class="theme-icon dark">🔅</span>
                <span class="theme-switch-toggle"></span>
              </label>
            </div>
          </div>
        </header>
        <textarea id="markdown-editor"  placeholder="Type or paste your Markdown here..."></textarea>
      </div>
      <div class="splitter" id="splitter" role="separator" aria-orientation="vertical" aria-valuenow="50" aria-controls="markdown-editor html-preview"  tabindex="0">
        <div class="splitter-handle"></div>
      </div>
      <div class="preview-pane">
        <div id="html-preview" class="preview-content"  role="region" aria-live="polite"></div>
      </div>
    </div>
    
    <div class="action-bar">
      <button class="button" id="print-btn">Print</button>
      <button class="button" id="copy-btn">Copy HTML to Clipboard</button>
      <button class="button" id="download-html-btn">Download HTML</button>
      <button class="button" id="download-md-btn">Download Markdown</button>
      <input type="text" id="filename" placeholder="Filename" value="markdown-export">
    </div>
  </main>
  
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(registration => {
            
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  const updateNotification = document.createElement('div');
                  updateNotification.style.position = 'fixed';
                  updateNotification.style.bottom = '20px';
                  updateNotification.style.right = '20px';
                  updateNotification.style.backgroundColor = '#FF8128';
                  updateNotification.style.color = 'white';
                  updateNotification.style.padding = '15px';
                  updateNotification.style.borderRadius = '5px';
                  updateNotification.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
                  updateNotification.style.zIndex = '9999';
                  updateNotification.innerHTML = 'App update available! <button id="update-app" style="background:white;color:#FF8128;border:none;padding:5px 10px;margin-left:10px;border-radius:3px;cursor:pointer;">Update Now</button>';
                  document.body.appendChild(updateNotification);
                  
                  document.getElementById('update-app').addEventListener('click', () => {
                    newWorker.postMessage({ action: 'skipWaiting' });
                    updateNotification.remove();
                    window.location.reload();
                });
              }
            });
          });
        })
          .catch(error => {
        });
        
        navigator.serviceWorker.addEventListener('controllerchange', () => {
      });
    });
}
    
    document.addEventListener('DOMContentLoaded', function() {
      if (window.innerWidth <= 768) {
        document.querySelector('.container').classList.add('mobile-view-editor');
    }
      const markdownEditor = document.getElementById('markdown-editor');
      const htmlPreview = document.getElementById('html-preview');
      const copyBtn = document.getElementById('copy-btn');
      const printBtn = document.getElementById('print-btn');
      const clearBtn = document.getElementById('clear-btn');
      const sampleBtn = document.getElementById('sample-btn');
      const downloadHtmlBtn = document.getElementById('download-html-btn');
      const downloadMdBtn = document.getElementById('download-md-btn');
      const themeSwitch = document.getElementById('theme-switch-checkbox');
      const filenameInput = document.getElementById('filename');
      const infoBtn = document.getElementById('info-btn');
      const infoModal = document.getElementById('info-modal');
      const closeModalBtn = document.getElementById('close-modal-btn');
      const flavorSelector = document.getElementById('flavor');
      
      const cleanCopyIframe = document.createElement('iframe');
      cleanCopyIframe.style.position = 'absolute';
      cleanCopyIframe.style.left = '-9999px';
      cleanCopyIframe.style.top = '0';
      cleanCopyIframe.style.width = '0';
      cleanCopyIframe.style.height = '0';
      cleanCopyIframe.style.opacity = '0';
      cleanCopyIframe.style.pointerEvents = 'none'; // Prevent any mouse interaction
      cleanCopyIframe.title = 'Copy HTML Helper'; 
      cleanCopyIframe.id = 'clean-copy-iframe';
      cleanCopyIframe.setAttribute('inert', ''); // Use inert attribute instead of aria-hidden
      cleanCopyIframe.setAttribute('tabindex', '-1'); // Make sure it's not in the tab order
      document.body.appendChild(cleanCopyIframe);
      
      const iframeDoc = cleanCopyIframe.contentDocument || cleanCopyIframe.contentWindow.document;
      iframeDoc.open();
      iframeDoc.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.2.5/purify.min.js"><\/script>
            <style>
          
              html, body {
                color: black !important;
                background-color: white !important;
                font-family: Aptos, Calibri, "Helvetica", Arial, sans-serif;
                font-size: 12pt !important;
            }
              
          
              * {
                color: black !important;
                background-color: transparent !important;
                font-family: Aptos, Calibri, "Helvetica", Arial, sans-serif;
                font-size: 12pt !important;
            }
              
          
              h1 {
                font-size: 18pt !important;
                margin-top: 1em;
                margin-bottom: 0.5em;
                font-weight: bold;
            }
              
              h2 {
                font-size: 16pt !important;
                margin-top: 1em;
                margin-bottom: 0.5em;
                font-weight: bold;
            }
              
              h3 {
                font-size: 14pt !important;
                margin-top: 1em;
                margin-bottom: 0.5em;
                font-weight: bold;
            }
              
              h4, h5, h6 {
                font-size: 12pt !important;
                margin-top: 1em;
                margin-bottom: 0.5em;
                font-weight: bold;
            }
              
              p {
                margin-bottom: 1em;
                font-size: 12pt !important;
            }
              
          
              ul, ol {
                margin-left: 2em;
                margin-bottom: 1em;
            }
              
              li {
                font-size: 12pt !important;
            }
              
          
              pre, code {
                font-family: Consolas, "Courier New", Courier, monospace !important;
                font-size: 10pt !important;
            }
              
              pre {
                margin: 1em 0;
                padding: 0.8em;
                border: 1px solid #ddd;
                background-color: #f5f5f5 !important;
                white-space: pre-wrap;
                line-height: 1.3 !important;
            }
              
          
              table {
                border-collapse: collapse;
                width: 100%;
                margin: 1em 0;
            }
              
              table, th, td {
                border: 1px solid #ddd;
            }
              
              th, td {
                padding: 0.5em;
                text-align: left;
                font-size: 12pt !important;
            }
              
          
              a {
                color: #0000EE !important;
                text-decoration: underline;
                font-size: 12pt !important;
            }
              
          
              blockquote {
                border-left: 2px solid #ddd;
                padding-left: 1em;
                margin-left: 1em;
                color: #555 !important;
            }
              
              blockquote * {
                font-size: 12pt !important;
            }
              
          
              .footnote-ref {
                vertical-align: super;
                font-size: 10pt !important;
                color: #0000EE !important;
            }
              
              .footnote {
                margin: 1em 0;
                padding: 0.5em;
                border-left: 2px solid #ddd;
            }
              
              .footnote * {
                font-size: 12pt !important;
            }
              
              .footnote-backref {
                color: #0000EE !important;
            }
            </style>
          </head>
          <body>
            <div id="copy-content"></div>
          </body>
        </html>
      `);
      iframeDoc.close();
      
      document.body.classList.add('dark-mode');
      themeSwitch.checked = true;
      
      const storedTheme = localStorage.getItem('darkMode');
      if (storedTheme === 'false') {
        document.body.classList.remove('dark-mode');
        themeSwitch.checked = false;
    }
      
      const preferredFlavor = localStorage.getItem('markdownFlavor') || 'github';
      
      if (flavorSelector) {
        flavorSelector.value = preferredFlavor;
    }
      
      
      let converter = new showdown.Converter({
        extensions: [footnotes({indentSpaces: preferredFlavor === 'github' ? 2 : 4})]
    });
      
      converter.setFlavor(preferredFlavor);
      
      
      function updatePreview() {
        const markdown = markdownEditor.value;
        const html = converter.makeHtml(markdown);
        
        const sanitizedHtml = DOMPurify.sanitize(html, {
          USE_PROFILES: { html: true },
          ADD_ATTR: ['target']
      });
        
        htmlPreview.innerHTML = sanitizedHtml;
        
        updateCleanCopyIframe(sanitizedHtml);
    }
      
      function updateCleanCopyIframe(html) {
        const iframeDoc = cleanCopyIframe.contentDocument || cleanCopyIframe.contentWindow.document;
        const contentElement = iframeDoc.getElementById('copy-content');
        
        if (contentElement) {
          const iframePurify = cleanCopyIframe.contentWindow.DOMPurify || DOMPurify;
          const sanitizedHtml = iframePurify.sanitize(html, {
            USE_PROFILES: { html: true },
            ADD_ATTR: ['target']
        });
          
          contentElement.innerHTML = sanitizedHtml;
          
          const allElements = iframeDoc.querySelectorAll('*');
          for (const el of allElements) {
            if (el.tagName !== 'HTML' && el.tagName !== 'HEAD' && el.tagName !== 'BODY' && el.tagName !== 'STYLE') {
              el.removeAttribute('class');
          }
        }
      }
    }
      
      function initMobileTabs() {
        const container = document.querySelector('.container');
        const tabButtons = document.querySelectorAll('.tab-button');
        const editorPane = document.querySelector('.editor-pane');
        const previewPane = document.querySelector('.preview-pane');
        
        const isMobileView = window.innerWidth <= 768;
        
        if (isMobileView) {
          const savedActiveTab = localStorage.getItem('activeMobileTab') || 'editor';
          setActiveTab(savedActiveTab);
      }
        
        tabButtons.forEach(button => {
          button.addEventListener('click', () => {
            const tabName = button.getAttribute('data-tab');
            setActiveTab(tabName);
            
            localStorage.setItem('activeMobileTab', tabName);
            
            if (tabName === 'preview') {
              updatePreview();
          }
        });
      });
        
        function setActiveTab(tabName) {
          tabButtons.forEach(btn => btn.classList.remove('active'));
          
          const activeButton = document.querySelector(`.tab-button[data-tab="${tabName}"]`);
          if (activeButton) {
            activeButton.classList.add('active');
        }
          
          container.classList.remove('mobile-view-editor', 'mobile-view-preview');
          container.classList.add(`mobile-view-${tabName}`);
      }
        
        window.addEventListener('resize', () => {
          const currentIsMobileView = window.innerWidth <= 768;
          
          if (currentIsMobileView && !isMobileView) {
            const savedActiveTab = localStorage.getItem('activeMobileTab') || 'editor';
            setActiveTab(savedActiveTab);
        } else if (!currentIsMobileView && isMobileView) {
            container.classList.remove('mobile-view-editor', 'mobile-view-preview');
        }
      });
    }
      
      const keyboardShortcuts = {
        editor: {
          key: 'e',
          modifier: 'Alt',
          description: 'Focus the editor',
          action: () => markdownEditor.focus()
      },
        preview: {
          key: 'p',
          modifier: 'Alt',
          description: 'Focus the preview',
          action: () => document.getElementById('html-preview').focus()
      },
        splitter: {
          key: 's',
          modifier: 'Alt',
          description: 'Focus the splitter',
          action: () => document.getElementById('splitter').focus()
      },
        copy: {
          key: 'c',
          modifier: 'Alt',
          description: 'Copy HTML to clipboard',
          action: () => copyHtml()
      },
        download: {
          key: 'd',
          modifier: 'Alt',
          description: 'Download HTML',
          action: () => downloadHTML()
      },
        clear: {
          key: 'x',
          modifier: 'Alt',
          description: 'Clear editor content',
          action: () => { markdownEditor.value = ''; updatePreview(); }
      },
        print: {
          key: 'r',
          modifier: 'Alt',
          description: 'Print document',
          action: () => { updatePreview(); setTimeout(() => window.print(), 100); }
      },
        help: {
          key: 'h',
          modifier: 'Alt',
          description: 'Open help dialog',
          action: () => openModal()
      },
        theme: {
          key: 't',
          modifier: 'Alt',
          description: 'Toggle theme',
          action: () => toggleTheme()
      }
    };
      
      let splitterIsDragging = false;
      let splitterElement;
      let editorPaneElement;
      let previewPaneElement;
      let editorContainerElement;

      function initResizablePanels() {
        try {
          splitterElement = document.getElementById('splitter');
          editorPaneElement = document.querySelector('.editor-pane');
          previewPaneElement = document.querySelector('.preview-pane');
          editorContainerElement = document.querySelector('.editor-container');
          
          const isMobileView = window.innerWidth <= 768;
          
          const initPosition = localStorage.getItem('splitterPosition') || '50';
          const percentage = parseFloat(initPosition);
          
          if (!isNaN(percentage) && percentage >= 20 && percentage <= 80) {
            editorPaneElement.style.flex = `0 0 ${percentage}%`;
            previewPaneElement.style.flex = `0 0 ${100 - percentage}%`;
        } else {
            editorPaneElement.style.flex = '0 0 50%';
            previewPaneElement.style.flex = '0 0 50%';
            localStorage.setItem('splitterPosition', '50');
        }
          splitterElement.setAttribute('aria-valuenow', percentage);
          
          if (isMobileView) {
            const mobileSavedPosition = localStorage.getItem('splitterPositionMobile');
            if (mobileSavedPosition) {
              const mobPercentage = parseFloat(mobileSavedPosition);
              if (!isNaN(mobPercentage) && mobPercentage >= 20 && mobPercentage <= 80) {
                editorPaneElement.style.flex = `0 0 ${mobPercentage}%`;
                previewPaneElement.style.flex = `0 0 ${100 - mobPercentage}%`;
                splitterElement.setAttribute('aria-valuenow', mobPercentage);
            }
          }
        }
      } catch (error) {
          try {
            editorPaneElement.style.flex = '0 0 50%';
            previewPaneElement.style.flex = '0 0 50%';
        } catch (e) {
        }
      }
        
        window.addEventListener('resize', function() {
          try {
            const currentIsMobileView = window.innerWidth <= 768;
            
            if (!currentIsMobileView) {
              const savedSplitterPosition = localStorage.getItem('splitterPosition') || '50';
              const percentage = parseFloat(savedSplitterPosition);
              if (!isNaN(percentage) && percentage >= 20 && percentage <= 80) {
                editorPaneElement.style.flex = `0 0 ${percentage}%`;
                previewPaneElement.style.flex = `0 0 ${100 - percentage}%`;
                splitterElement.setAttribute('aria-valuenow', percentage);
            } else {
                editorPaneElement.style.flex = `0 0 50%`;
                previewPaneElement.style.flex = `0 0 50%`;
                splitterElement.setAttribute('aria-valuenow', 50);
            }
          }
        } catch (error) {
        }
      });
        
        splitterElement.addEventListener('mousedown', function(e) {
          e.preventDefault();
          splitterIsDragging = true;
          splitterElement.classList.add('dragging');
          
          document.body.style.userSelect = 'none';
      });
        
        document.addEventListener('mousemove', function(e) {
          try {
            if (!splitterIsDragging) return;
            
            const containerRect = editorContainerElement.getBoundingClientRect();
            
            const isMobileView = window.innerWidth <= 768;
            
            if (isMobileView) {
              const containerHeight = containerRect.height;
              const mousePosition = e.clientY - containerRect.top;
              
              const percentage = Math.min(Math.max((mousePosition / containerHeight) * 100, 20), 80);
              
              editorPaneElement.style.flex = `0 0 ${percentage}%`;
              previewPaneElement.style.flex = `0 0 ${100 - percentage}%`;
              
              splitterElement.setAttribute('aria-valuenow', percentage);
              
              localStorage.setItem('splitterPositionMobile', percentage);
          } else {
              const containerWidth = containerRect.width;
              const mousePosition = e.clientX - containerRect.left;
              
              const percentage = Math.min(Math.max((mousePosition / containerWidth) * 100, 20), 80);
              
              editorPaneElement.style.flex = `0 0 ${percentage}%`;
              previewPaneElement.style.flex = `0 0 ${100 - percentage}%`;
              
              splitterElement.setAttribute('aria-valuenow', percentage);
              
              localStorage.setItem('splitterPosition', percentage);
          }
        } catch (error) {
            splitterIsDragging = false; // Stop dragging if there's an error
        }
      });
        
        document.addEventListener('mouseup', function() {
          try {
            if (splitterIsDragging) {
              splitterIsDragging = false;
              splitterElement.classList.remove('dragging');
              
              document.body.style.userSelect = '';
              
          }
        } catch (error) {
            splitterIsDragging = false;
            document.body.style.userSelect = '';
            try { splitterElement.classList.remove('dragging'); } catch (e) {}
        }
      });
        
        splitterElement.addEventListener('keydown', function(e) {
          try {
            const flexValue = editorPaneElement.style.flex || '';
            
            const savedPosition = localStorage.getItem('splitterPosition');
            let currentPosition;
            
            if (savedPosition) {
              currentPosition = parseFloat(savedPosition);
          } else if (flexValue) {
              const match = flexValue.match(/\d+(\.\d+)?/);
              if (match && match[0]) {
                currentPosition = parseFloat(match[0]);
            } else {
                currentPosition = 50;
            }
          } else {
              currentPosition = 50;
          }
            
            if (isNaN(currentPosition) || currentPosition < 20) {
              currentPosition = 50;
          } else if (currentPosition > 80) {
              currentPosition = 80;
          }
            
            let newPosition = currentPosition;
            
            const STEP_SIZE = 10;
          
          if (e.key === 'ArrowLeft') {
            newPosition = Math.max(20, currentPosition - STEP_SIZE);
            e.preventDefault();
        } else if (e.key === 'ArrowRight') {
            newPosition = Math.min(80, currentPosition + STEP_SIZE);
            e.preventDefault();
        } else if (e.key === 'ArrowUp') {
            newPosition = Math.max(20, currentPosition - STEP_SIZE * 2);
            e.preventDefault();
        } else if (e.key === 'ArrowDown') {
            newPosition = Math.min(80, currentPosition + STEP_SIZE * 2);
            e.preventDefault();
        } else if (e.key === 'Home') {
            newPosition = 20;
            e.preventDefault();
        } else if (e.key === 'End') {
            newPosition = 80;
            e.preventDefault();
        } else if (e.key === 'Enter' || e.key === ' ') {
            newPosition = 50;
            e.preventDefault();
        }
          
          if (newPosition !== currentPosition) {
            editorPaneElement.style.flex = `0 0 ${newPosition}%`;
            previewPaneElement.style.flex = `0 0 ${100 - newPosition}%`;
            
            splitterElement.setAttribute('aria-valuenow', newPosition);
            
            localStorage.setItem('splitterPosition', newPosition);
            
            document.getElementById('sr-announcements').textContent = `Editor width ${Math.round(newPosition)}%, preview width ${Math.round(100-newPosition)}%`;
        }
        } catch (error) {
        }
      });
        
        splitterElement.addEventListener('touchstart', function(e) {
          try {
            e.preventDefault();
            splitterIsDragging = true;
            splitterElement.classList.add('dragging');
        } catch (error) {
        }
      });
        
        document.addEventListener('touchmove', function(e) {
          try {
            if (!splitterIsDragging) return;
            
            const touch = e.touches[0];
            const containerRect = editorContainerElement.getBoundingClientRect();
            
            const isMobileView = window.innerWidth <= 768;
            
            if (isMobileView) {
              const containerHeight = containerRect.height;
              const touchPosition = touch.clientY - containerRect.top;
              
              const percentage = Math.min(Math.max((touchPosition / containerHeight) * 100, 20), 80);
              
              editorPaneElement.style.flex = `0 0 ${percentage}%`;
              previewPaneElement.style.flex = `0 0 ${100 - percentage}%`;
              
              splitterElement.setAttribute('aria-valuenow', percentage);
              
              localStorage.setItem('splitterPositionMobile', percentage);
          } else {
              const containerWidth = containerRect.width;
              const touchPosition = touch.clientX - containerRect.left;
              
              const percentage = Math.min(Math.max((touchPosition / containerWidth) * 100, 20), 80);
              
              editorPaneElement.style.flex = `0 0 ${percentage}%`;
              previewPaneElement.style.flex = `0 0 ${100 - percentage}%`;
              
              splitterElement.setAttribute('aria-valuenow', percentage);
              
              localStorage.setItem('splitterPosition', percentage);
          }
        } catch (error) {
            splitterIsDragging = false; // Stop dragging if there's an error
        }
      });
        
        document.addEventListener('touchend', function() {
          try {
            if (splitterIsDragging) {
              splitterIsDragging = false;
              splitterElement.classList.remove('dragging');
          }
        } catch (error) {
            splitterIsDragging = false;
            try { splitterElement.classList.remove('dragging'); } catch (e) {}
        }
      });
    }
      
      
      function downloadHTML() {
        const filename = filenameInput.value || 'markdown-export';
        const markdown = markdownEditor.value;
        const freshConverter = new showdown.Converter({
          tables: true,
          tasklists: true,
          strikethrough: true,
          ghCodeBlocks: true,
          extensions: [footnotes]
      });
        const html = freshConverter.makeHtml(markdown);
        
        const sanitizedHtml = DOMPurify.sanitize(html, {
          USE_PROFILES: { html: true },
          ADD_ATTR: ['target']
      });
        
        const styleContent=`body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;line-height:1.6;max-width:800px;margin:0 auto;padding:20px;color:#24292e;background-color:white}pre{background-color:#f6f8fa;padding:16px;overflow:auto;border-radius:3px;border:1px solid #e1e4e8}code{border-radius:3px;font-family:"SFMono-Regular",Consolas,"Liberation Mono",Menlo,monospace}:not(pre)>code{background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em}table{border-collapse:collapse;width:100%;margin-bottom:16px}table,th,td{border:1px solid #dfe2e5;padding:8px}img{max-width:100%}blockquote{border-left:4px solid #dfe2e5;padding-left:16px;color:#6a737d;margin-left:0;margin-right:0}a{color:#0366d6;text-decoration:underline}h1,h2,h3,h4,h5,h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.footnote{margin-top:8px;margin-bottom:8px;padding:5px 10px;font-size:0.9em;color:#6a737d;background-color:rgba(0,0,0,0.02);border-radius:4px}.footnote .footnote-content{display:inline-block;vertical-align:top}.footnote .footnote-content p{margin:0}.footnote .footnote-content p+p{margin-top:0.8em}.footnote a{text-decoration:none}.footnote-ref{text-decoration:none;font-size:0.75em;vertical-align:super;line-height:normal;color:#0366d6;padding:0 1px}.footnote-backref{text-decoration:none;font-size:0.85em;color:#0366d6;margin-right:4px;font-weight:bold}.footnotes-section{margin-top:40px}.footnotes-section hr{border:none;border-top:1px solid #dfe2e5;margin:30px 0 20px 0}.footnotes-section h2{font-size:1.2em;margin-bottom:20px}.footnotes{display:flex;flex-direction:column;gap:5px}`;
        
        const fullHtml = `
<!--
Markdown Converter - A browser-based Markdown editor with HTML conversion and live preview
Copyright (c) 2025 Stephen Alexander
MIT License

Generated content using:
- Showdown (v2.1.0) - MIT License - https://github.com/showdownjs/showdown 
- DOMPurify (v3.2.5) - Dual-licensed under Apache License 2.0 and Mozilla Public License 2.0 - https://github.com/cure53/DOMPurify
-->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>${filename}</title>
  <meta name="generator" content="Markdown Converter by Stephen Alexander">
  <style>${styleContent}</style>
</head>
<body>
  ${sanitizedHtml}
</body>
</html>
        `;
        
        downloadFile(fullHtml, `${filename}.html`, 'text/html');
    }
      
      function downloadMarkdown() {
        const filename = filenameInput.value || 'markdown-export';
        const markdown = markdownEditor.value;
        
        downloadFile(markdown, `${filename}.md`, 'text/markdown');
    }
      
      function downloadFile(content, filename, type) {
        const blob = new Blob([content], { type: type });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
      
      function loadSample() {
        markdownEditor.value = "Loading README.md...";
        
        fetch('./README.md')
          .then(response => {
            if (!response.ok) {
              throw new Error(`Failed to load README.md: ${response.status} ${response.statusText}`);
          }
            return response.text();
        })
          .then(content => {
            markdownEditor.value = content;
            
            updateConverterWithCurrentFlavor();
            
            updatePreview();
        })
          .catch(error => {
            
            const preferredFlavor = localStorage.getItem('markdownFlavor') || 'github';
            const isGitHubStyle = preferredFlavor === 'github';
            
            const createSample = () => {
              return `# Markdown Converter Demo

Welcome! This is a **live preview** of your Markdown.

## Quick Examples

- **Bold** and *italic* text
- [Links](https://example.com) and inline \`code\`

### Lists
1. Numbered lists
2. Work great
   - Nested items too
   - With proper indentation

### Code Block
\`\`\`javascript
function hello() {
  return "Hello, world!";
}
\`\`\`

### Footnotes
This has a footnote[^1].

[^1]: Footnotes appear at the bottom.

---

**💡 Tip:** Click the **❓** button for complete documentation and examples!`;
          };
            
            markdownEditor.value = createSample();
            updatePreview();
        });
    }
      
      function updateConverterWithCurrentFlavor() {
        const preferredFlavor = localStorage.getItem('markdownFlavor') || 'github';
        
        const newConverter = new showdown.Converter({
          extensions: [footnotes({indentSpaces: preferredFlavor === 'github' ? 2 : 4})]
      });
        
        newConverter.setFlavor(preferredFlavor);
        
        converter = newConverter;
    }
      
      function adjustMarkdownIndentation(content, flavor) {
        const indentSpaces = flavor === 'github' ? 2 : 4;
        const lines = content.split('\n');
        const result = [];
        
        const indentPattern = /^(\s+)(.*)$/;
        
        let inCodeBlock = false;
        
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i];
          
          if (line.trim().startsWith('```')) {
            inCodeBlock = !inCodeBlock;
            result.push(line); // Keep code block markers unchanged
            continue;
        }
          
          if (inCodeBlock) {
            result.push(line);
            continue;
        }
          
          const match = line.match(indentPattern);
          
          if (match) {
            const currentIndent = match[1]; 
            const content = match[2];
            
            const spaceCount = currentIndent.length;
            
            const indentLevel = Math.ceil(spaceCount / 2);
            
            const newIndent = ' '.repeat(indentSpaces * indentLevel);
            result.push(newIndent + content);
        } else {
            result.push(line);
        }
      }
        
        return result.join('\n');
    }
      
      function toggleTheme() {
        const isDarkMode = document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', isDarkMode);
        themeSwitch.checked = isDarkMode;
    }
      
      let lastFocusedElement;
      const focusableSelectors = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';
      
      function openModal() {
        lastFocusedElement = document.activeElement;
        
        infoModal.style.display = 'block';
        
        document.getElementById('sr-announcements').textContent = 'Information dialog opened';
        
        document.body.style.overflow = 'hidden';
        
        const modalBody = document.getElementById('modal-description');
        
        const focusFirstElement = () => {
          const focusableElements = infoModal.querySelectorAll(focusableSelectors);
          const firstFocusableElement = focusableElements[0];
          if (firstFocusableElement) {
            setTimeout(() => firstFocusableElement.focus(), 50);
          }
        };
        
        fetch('./help.html')
          .then(response => {
            if (!response.ok) throw new Error('Help file not found');
            return response.text();
          })
          .then(helpContent => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(helpContent, 'text/html');
            const bodyContent = doc.body.innerHTML;
            modalBody.innerHTML = bodyContent;
            focusFirstElement();
          })
          .catch(() => {
            modalBody.innerHTML = `
              <p>Real-time Markdown editor with HTML preview. Works offline in any modern browser.</p>
              <p><strong>Shortcuts:</strong> Alt+E (editor), Alt+P (preview), Alt+C (copy), Alt+D (download), Alt+T (theme), Alt+H (help)</p>
              <p><strong>Footnotes:</strong> Use [^1] syntax. Set indentation in toolbar dropdown.</p>
              <p>MIT License © 2025 Stephen Alexander. Uses Showdown & DOMPurify libraries.</p>
              <p><strong>More help:</strong> <a href="./help.html" target="_blank">help.html</a></p>
            `;
            focusFirstElement();
          });
    }
      
      function closeModal() {
        infoModal.style.display = 'none';
        
        document.getElementById('sr-announcements').textContent = 'Information dialog closed';
        
        document.body.style.overflow = '';
        
        if (lastFocusedElement) {
          setTimeout(() => {
            lastFocusedElement.focus();
        }, 50);
      }
    }
      
      function trapTabKey(e) {
        if (infoModal.style.display !== 'block') return;
        
        const focusableElements = infoModal.querySelectorAll(focusableSelectors);
        const firstFocusableElement = focusableElements[0];
        const lastFocusableElement = focusableElements[focusableElements.length - 1];
        
        if (e.key === 'Tab') {
          if (e.shiftKey && document.activeElement === firstFocusableElement) {
            e.preventDefault();
            lastFocusableElement.focus();
        }
          else if (!e.shiftKey && document.activeElement === lastFocusableElement) {
            e.preventDefault();
            firstFocusableElement.focus();
        }
      }
    }
      
      window.addEventListener('click', (e) => {
        if (e.target === infoModal) {
          closeModal();
      }
    });
      
      document.addEventListener('keydown', (e) => {
        if (infoModal.style.display === 'block') {
          if (e.key === 'Escape') {
            closeModal();
        }
          
          trapTabKey(e);
          
          return;
      }
        
        Object.values(keyboardShortcuts).forEach(shortcut => {
          if (e.key.toLowerCase() === shortcut.key.toLowerCase() && 
              ((shortcut.modifier === 'Alt' && e.altKey) ||
               (shortcut.modifier === 'Ctrl' && e.ctrlKey) ||
               (shortcut.modifier === 'Shift' && e.shiftKey))) {
            e.preventDefault();
            shortcut.action();
            
            document.getElementById('sr-announcements').textContent = shortcut.description + ' activated';
        }
      });
    });
      
      markdownEditor.addEventListener('input', updatePreview);
      printBtn.addEventListener('click', () => { 
        updatePreview();
        setTimeout(() => window.print(), 100);
    });
      copyBtn.addEventListener('click', () => { copyHtml(); });
      clearBtn.addEventListener('click', () => { markdownEditor.value = ''; updatePreview(); });
      sampleBtn.addEventListener('click', loadSample);
      downloadHtmlBtn.addEventListener('click', downloadHTML);
      downloadMdBtn.addEventListener('click', downloadMarkdown);
      themeSwitch.addEventListener('change', toggleTheme);
      infoBtn.addEventListener('click', openModal);
      closeModalBtn.addEventListener('click', closeModal);
      
      function updateIndentationExample() {
        const preferredFlavor = localStorage.getItem('markdownFlavor') || 'github';
        const isGitHubStyle = preferredFlavor === 'github';
        
        const spacesNum = isGitHubStyle ? 2 : 4;
        
        const indentDisplays = [
          document.getElementById('indent-setting-display'),
          document.getElementById('list-indent-display'),
          document.getElementById('code-indent-display')
        ];
        
        indentDisplays.forEach(display => {
          if (display) {
            display.textContent = spacesNum;
        }
      });
        
        const flavorDisplay = document.getElementById('flavor-display');
        if (flavorDisplay) {
          flavorDisplay.textContent = isGitHubStyle ? 'GitHub' : 'CommonMark';
      }
        
        const indentationNote = document.getElementById('indentation-note');
        if (indentationNote) {
          if (isGitHubStyle) {
            indentationNote.innerHTML = '<strong>Note:</strong> GitHub Flavored Markdown uses 2-space indentation for nested lists. First level items have no indentation, second level items are indented by 2-3 spaces, and third level items by 4-6 spaces.';
        } else {
            indentationNote.innerHTML = '<strong>Note:</strong> CommonMark uses 4-space indentation for nested lists. First level items have no indentation, second level items are indented by 4 spaces, and third level items by 8 spaces.';
        }
      }
        
        const footnoteExample = document.getElementById('footnote-indent-example');
        if (footnoteExample) {
          const indent = ' '.repeat(spacesNum);
          footnoteExample.textContent = `
[^2]: First paragraph of the footnote.
${indent}
${indent}Second paragraph of the footnote (indented ${spacesNum} spaces).
          `;
      }
        
        const listExample = document.getElementById('list-indent-example');
        if (listExample) {
          if (isGitHubStyle) {
            const level1Indent = '   '; // 3 spaces
            const level2Indent = '      '; // 6 spaces
            
            listExample.textContent = `
1. First level item
2. First level item
${level1Indent}- Second level item (indented 3 spaces)
${level1Indent}- Second level item (indented 3 spaces)
${level2Indent}* Third level item (indented 6 spaces)
${level2Indent}* Third level item (indented 6 spaces)
            `;
        } else {
            const level1Indent = '    '; // 4 spaces
            const level2Indent = '        '; // 8 spaces
            
            listExample.textContent = `
1. First level item
2. First level item
${level1Indent}- Second level item (indented 4 spaces)
${level1Indent}- Second level item (indented 4 spaces)
${level2Indent}* Third level item (indented 8 spaces)
${level2Indent}* Third level item (indented 8 spaces)
            `;
        }
      }
        
        const codeExample = document.getElementById('code-indent-example');
        if (codeExample) {
          const indent = ' '.repeat(spacesNum);
          
          codeExample.textContent = `
Normal text.

${indent}This is a code block.
${indent}It's indented with ${spacesNum} spaces.
  
Normal text again.
          `;
      }
    }
      
      flavorSelector.addEventListener('change', function() {
        const selectedFlavor = flavorSelector.value;
        localStorage.setItem('markdownFlavor', selectedFlavor);
        
        const indentSize = selectedFlavor === 'github' ? 2 : 4;
        
        updateConverterWithCurrentFlavor();
        
        updatePreview();
        
        updateIndentationExample();
        
        const actionBar = document.querySelector('div.action-bar');
        if (actionBar) {
          const message = document.createElement('button');
          const flavorName = selectedFlavor === 'github' ? 'GitHub' : 'CommonMark';
          message.textContent = `Markdown flavor set to ${flavorName}`;
          message.style.backgroundColor = '#4CAF50';
          message.style.color = 'white';
          message.classList.add('button');
          
          actionBar.appendChild(message);
          
          setTimeout(() => {
            actionBar.removeChild(message);
        }, 2000);
      }
    });
      
      
      updateConverterWithCurrentFlavor();
      
      updatePreview();
      
      updateIndentationExample();
      
      const storedMarkdown = localStorage.getItem('markdownContent');
      if (storedMarkdown) {
        markdownEditor.value = storedMarkdown;
        updatePreview();
    }
      
      markdownEditor.addEventListener('input', () => {
        localStorage.setItem('markdownContent', markdownEditor.value);
        
        if (window.innerWidth <= 768) {
          updatePreview();
      }
    });
      
      if (!localStorage.getItem('splitterPosition')) {
        localStorage.setItem('splitterPosition', '50');
    }
      
      initResizablePanels();
      
      initMobileTabs();
  });
    const copyHtml = () => {
  try {
    const cleanCopyIframe = document.getElementById('clean-copy-iframe');
    const iframeDoc = cleanCopyIframe.contentDocument || cleanCopyIframe.contentWindow.document;
    
    const contentElement = iframeDoc.getElementById('copy-content');
    
    cleanCopyIframe.removeAttribute('inert');
    
    const range = iframeDoc.createRange();
    range.selectNodeContents(contentElement);
    
    const selection = cleanCopyIframe.contentWindow.getSelection();
    selection.removeAllRanges();
    selection.addRange(range);
    
    const successful = iframeDoc.execCommand('copy');
    
    selection.removeAllRanges();
    
    cleanCopyIframe.setAttribute('inert', '');
    
    if (successful) {
      const actionBar = document.querySelector('div.action-bar');
      
      const message = document.createElement('button');
      message.textContent = 'Content copied!';
      message.style.backgroundColor = '#4CAF50';
      message.style.color = 'white';
      message.classList.add('button');
      
      if (actionBar) {
        actionBar.appendChild(message);
        
        setTimeout(() => {
          actionBar.removeChild(message);
      }, 2000);
    }
  } else {
}
    
    return successful;
} catch (err) {
    return false;
}
}

  </script>

  <!-- Modal -->
  <aside id="info-modal" class="modal" role="dialog" aria-modal="true"  >
    <!-- Invisible focus boundary at the top of the modal -->
    <div tabindex="0" class="focus-boundary" style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title">Markdown Converter</h2>
      </div>
      <div class="modal-body" id="modal-description">
        <p>Real-time Markdown editor with HTML preview. Works offline in any modern browser.</p>
        <p><strong>Shortcuts:</strong> Alt+E (editor), Alt+P (preview), Alt+C (copy), Alt+D (download), Alt+T (theme), Alt+H (help)</p>
        <p><strong>Footnotes:</strong> Use [^1] syntax. Set indentation in toolbar dropdown.</p>
        <p>MIT License © 2025 Stephen Alexander. Uses Showdown & DOMPurify libraries.</p>
      </div>
      <div class="modal-footer">
        <button id="close-modal-btn" class="button" >✅</button>
      </div>
    </div>
    <!-- Invisible focus boundary at the bottom of the modal -->
    <div tabindex="0" class="focus-boundary" style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;"></div>
  </aside>
</body>
</html>
